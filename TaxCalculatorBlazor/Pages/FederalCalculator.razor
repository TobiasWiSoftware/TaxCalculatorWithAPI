@page "/FederalCalculator"


@code {

}

@if (Input == null)
{
    <p><em>Loading</em></p>
}
else
{

    <div class="center">
        <div>
            <EditForm Model="@Input" OnValidSubmit="@CalculateTax" class="form-group">
                <DataAnnotationsValidator />
                <ValidationSummary />
                <div class="left">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="year" @onchange="() => HandleYearChange(2023)" checked=" @IsCurrentYear(2023)" />
                        <label class="form-check-label">2023</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="year" @onchange="() => HandleYearChange(2024)" checked="@IsCurrentYear(2024)" />
                        <label class="form-check-label">
                            2024
                        </label>
                    </div>
                </div>

                <ValidationMessage For="@(() => Input.Year)" />

                <!-- Firstname input -->
                <label class="form-label">Gesamtsold</label>
                <input @bind="Input.GrossIncome" type="decimal" class="form-control" />

                <ValidationMessage For="@(() => Input.Year)" />

                <div class="left">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" checked @onchange="@(() => Input.BillingPeriodMonthly = true)" name="BillingPeriod" />
                        <label class="form-check-label">
                            <!-- korrigiert for-Attribut -->
                            Monat
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" @onchange="@(() => Input.BillingPeriodMonthly = false)" name="BillingPeriod" />
                        <label class="form-check-label">
                            <!-- korrigiert for-Attribut -->
                            Jahr
                        </label>
                    </div>
                </div>

                <label class="form-label">Steuerklasse</label>
                <select @bind="Input.TaxClass" name="TaxClass" class="form-control">
                    <option value="1">I</option>
                    <option value="2">II</option>
                    <option value="3">III</option>
                    <option value="4">IV</option>
                    <option value="5">V</option>
                    <option value="6">VI</option>
                </select>

                <div class="left">
                    <div class="form-check">
                        <input name="church" class="form-check-input" type="radio" @onchange="HandleChurchTaxChange" />
                        <label class="form-check-label">
                            Mit Kirchensteuer
                        </label>
                    </div>
                    <div class="form-check">
                        <input name="church" class="form-check-input" type="radio" @onchange="HandleChurchTaxChange" checked />
                        <label class="form-check-label">
                            Ohne Kirchensteuer
                        </label>
                    </div>
                </div>

                <label class="form-label">Kinder</label>
                <div class="left">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" @onchange="HandleChildrenChange" name="HasChildren" value="true" />
                        <label class="form-check-label">
                            Ja
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" @onchange="HandleChildrenChange" name="HasChildren" value="false" checked />
                        <label class="form-check-label">
                            Nein
                        </label>
                    </div>
                </div>

                @if (ChildrenTaxCreditDisplayed)
                {
                    <label class="form-label">Kinderfreibeträge</label>
                    <select name="ChildTaxCredit" @bind="ChildTaxCreditString" class="form-control">
                        <option value="0">0</option>
                        <option value="0,5">0,5</option>
                        <option value="1">1</option>
                        <option value="1,5">1,5</option>
                        <option value="2">2</option>
                        <option value="2,5">2,5</option>
                        <option value="3">3</option>
                        <option value="3,5">3,5</option>
                        <option value="4">4</option>
                        <option value="4,5">4,5</option>
                        <option value="5">5</option>
                        <option value="5,5">5,5</option>
                        <option value="6">6</option>
                        <option value="6,5">6,5</option>
                        <option value="7">7</option>
                        <option value="7,5">7,5</option>
                        <option value="8">8</option>
                        <option value="8,5">8,5</option>
                        <option value="9">9</option>
                        <option value="9,5">9,5</option>
                    </select>
                }
                else
                {
                    ChildTaxCreditString = "0";
                }

                <label>Krankenversicherung:</label>
                <select name="FederalInsurance" @onchange="HandlePrivateInsuranceChange" class="form-control">
                    <option selected value="false">nicht berücksichtigen</option>
                    <option value="true">berücksichtigen</option>
                </select>

                @if (WithPrivateInsurance)
                {
                    <label class="form-label">Eigenbeitrag PKV</label>
                    <input @bind="Input.PrivateInsurance" type="decimal" class="form-control" />
                }

                <button type="submit" class="btn btn-primary btn-sm blue">Berechnen</button>


                <!-- Submit button -->


            </EditForm>
        </div>

        @if (Output != null)
        {
            <div class="output-container">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th scope="col">Unverb. Berechnung</th>
                            <th scope="col" class="right">Monat</th>
                            <th scope="col" class="right">Jahr</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">Bruttogehalt</th>
                            <td class="right">@Output.BillingInput.GrossIncome.ToString("N2")</td>
                            <td class="right">@Math.Round(Output.BillingInput.GrossIncome * 12, 2).ToString("N2")</td>
                        </tr>
                        <tr>
                            <td scope="row">Lohnsteuer</td>
                            <td class="right">@Output.TaxSum.ToString("N2")</td>
                            <td class="right">@Math.Round(Output.TaxSum * 12, 2).ToString("N2")</td>
                        </tr>
                        <tr>
                            <td scope="row">Kirchensteuer</td>
                            <td class="right">@Output.ChurchTaxSum.ToString("N2")</td>
                            <td class="right">@Math.Round(Output.SolidaryTaxSum * 12, 2).ToString("N2")</td>
                        </tr>
                        <tr>
                            <td scope="row">Solidaritätszuschlag</td>
                            <td class="right">@Output.SolidaryTaxSum.ToString("N2")</td>
                            <td class="right">@Math.Round(Output.SolidaryTaxSum * 12, 2).ToString("N2")</td>
                        </tr>
                        <tr>
                            <th scope="row">Steuern</th>
                            <td class="right">@Output.TotalTaxSum.ToString("N2")</td>
                            <td class="right">@Math.Round(Output.TotalTaxSum * 12, 2).ToString("N2")</td>
                        </tr>
                        <tr>
                            <td scope="row">Krankenversicherung</td>
                            <td class="right">@Output.InsuranceSum.ToString("N2")</td>
                            <td class="right">@Math.Round(Output.InsuranceSum * 12, 2).ToString("N2")</td>
                        </tr>
                        <tr>
                            <th scope="row">Sozialabgaben</th>
                            <td class="right">@Output.InsurancesTotal.ToString("N2")</td>
                            <td class="right">@Math.Round(Output.InsurancesTotal * 12, 2).ToString("N2")</td>
                        </tr>
                        <tr>
                            <th scope="row">Netto</th>
                            <th scope="row" class="right">@Output.Transferamount.ToString("N2")</th>
                            <th scope="row" class="right">@Math.Round(Output.Transferamount * 12, 2).ToString("N2")</th>
                        </tr>
                    </tbody>
                </table>
                <br />
                <br />
                <p class="justify">
                    Erläuterungen: Bei der Berechnung des Nettobetrages wurden der Grundfreibetrag nach Steuerklasse,
                    der Arbeitnehmerfreibetrag, die Kinderfreibeträge @(WithPrivateInsurance ? "die Steuerminderung durch den Eigenanteil der PKV " : "") berücksichtigt. Sind nicht alle Angaben auf der Lohnsteuerkarte
                    eingetragen, kann der Überweisungsbetrag niedriger als das berechnete Netto ausfallen. Alle Angaben ohne Gewähr.
                </p>
            </div>

            <button type="submit" class="btn btn-primary btn-sm red">Drucken (Aktuell nicht verfügbar)</button>

        }

    </div>


}